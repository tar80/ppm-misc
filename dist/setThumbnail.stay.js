Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var r;if(null==this)throw new Error('Array.indexOf: "this" is null or not defined');var n=Object(this),a=n.length>>>0;if(0===a)return-1;var i=null!=t?t:0;if(Math.abs(i)===Infinity&&(i=0),i>=a)return-1;for(r=Math.max(i>=0?i:a-Math.abs(i),0);r<a;){if(r in n&&n[r]===e)return r;r++}return-1});var e,t={ppmName:"ppx-plugin-manager",ppmVersion:.95,language:"ja",encode:"utf16le",nlcode:"\r\n",nltype:"crlf",ppmID:"P",ppmSubID:"Q"},useLanguage=function(){var e=PPx.Extract("%*getcust(S_ppm#global:lang)");return"en"===e||"ja"===e?e:t.language},r=PPx.CreateObject("Scripting.FileSystemObject"),isEmptyStr=function(e){return""===e},n="ppm-misc",a="folder.jpg",i='%sgu"ppmcache"\\complist\\thumbcmd.txt',s={en:{start:"Start thumbnail registration",noEntries:"no entries",viewstyle:"Please specify thumbnail viewstyle",abort:"aborting. no image mode",title:"Thumbnail generation command",halfway:"Discard StayMode",progress:"progress",completed:"completed"},ja:{start:"サムネイル登録を開始します",noEntries:"対象エントリがありません",viewstyle:"サムネイル形式を指定してください",abort:"中止。サムネイル表示ではありません",title:"サムネイル生成コマンド",halfway:"StayModeを破棄します",progress:"進捗",completed:"完了"}}[useLanguage()],c=PPx.Extract("%n"),o=PPx.Extract("%FD"),u=PPx.Extract("%*temp(misc_thumb,d)"),x=0===PPx.EntryMarkCount?PPx.Entry.AllEntry:PPx.Entry.AllMark,P=0,l=0,main=function(){var t="'title':'"+s.title+"','mode':'e','list':'on','module':'off','detail':'user1','leavecancel':false,'file':'"+i+"'",r=PPx.Extract('%*script("%sgu\'ppmlib\'\\input.js","{'+t+'}")');("[error]"===r||/^\s*;/.test(r))&&(PPx.Execute("*delete "+u),PPx.Quit(-1)),(e=isEmptyStr(r)?setThumbnail:createThumbnail(r))()},ppx_Progress=function(){return e()},ppx_finally=function(){return PPx.Echo("[WARN] instance remain setThumbnail.stay.js")},ppx_resume=function(){isOkey(s.halfway)&&(PPx.StayMode=0,setThumbnail(!0))},createThumbnail=function(e){PPx.StayMode=2;for(var t=PPx.StayMode,r=extractInputData(e),n=r[0],a=r[1],i=[];!x.atEnd();x.moveNext()){var p=x.Name;16&x.Attributes||!~n.indexOf(PPx.Extract('%*name(T,"'+p+'")'))||i.push(createCmdline(a,o+"\\"+p,u+"\\"+x.Index+".bmp"))}return P=i.length,x.Reset(),function(){linemessage(s.progress+" "+l+"/"+P),l++,i.length>0?PPx.Execute("*run -min -nostartmsg -noppb %0ppbw.exe -c "+i.shift()+"%%&*execute "+c+',*script ":'+t+',ppx_Progress"'):(PPx.StayMode=0,setThumbnail(P>0))}},setThumbnail=function(e){if(void 0===e&&(e=!1),e||0!==PPx.EntryDisplayDirectories){if(PPx.Extract("%n")!==c&&PPx.Execute("*focus "+c),isOkey(s.start)){for(o!==extract("%FD")&&PPx.Execute('%j"'+o+'"');!hasImageView();){if(!isOkey(s.viewstyle))return void PPx.Execute("*delete "+u);PPx.Execute("*viewstyle -temp")}for(var t=PPx.EntryIndex,n=getFolderThumbNames();!x.atEnd();x.moveNext())if(16&x.Attributes)for(var a=0;a<n.length;a++){var i=n[a],P=x.Name+"\\"+i;if(r.FileExists(P)){PPx.EntryIndex=x.Index,PPx.Execute("*setentryimage "+P+" -save");break}}else if(e){var l=x.Index,p=u+"\\"+l+".bmp";r.FileExists(p)&&(PPx.EntryIndex=l,PPx.Execute("*setentryimage "+p+" -save"))}PPx.EntryIndex=t,PPx.Execute("*zoom +0"),PPx.Execute("*delete "+u),linemessage(s.completed)}}else linemessage(s.noEntries)},extract=function(e){return PPx.Extract("%*extract("+c+',"%('+e+'%)")')},linemessage=function(e){return PPx.Execute("*execute "+c+',*linemessage !"'+e)},isOkey=function(e){return 0===PPx.Execute('%"'+n+'"%Q"'+e+'"')},hasImageView=function(){var e=/(\s|,|)n[\d,]+/,t=PPx.Extract("%*viewstyle");return e.test(t)},getFolderThumbNames=function(){var e=PPx.Extract("%*getcust(S_ppm#user:misc_thumbnames)");return(a+","+e).replace(/;/g,",").split(",")},p=/(%src%|%dst%)/g,createCmdline=function(e,t,r){var n={"%src%":t,"%dst%":r};return e.replace(p,(function(e){return n[e]}))},extractInputData=function(e){var t=[],r=/^[^<]*<([^>]+)>\s*(.+)$/,n=e.replace(r,(function(e,r,n){return t=r.replace(/;/g,",").split(","),n}));return[t,n]};main();
