var e,validArgs=function(){for(var e=[],t=PPx.Arguments;!t.atEnd();t.moveNext())e.push(t.value);return e},t={ppmName:"ppx-plugin-manager",ppmVersion:.95,language:"ja",encode:"utf16le",nlcode:"\r\n",nltype:"crlf",ppmID:"P",ppmSubID:"Q"},tmp=function(){var e=PPx.Extract('%*extract(C,"%%*temp()")');return{dir:e,file:e+"_ppmtemp",lf:e+"_temp.xlf",stdout:e+"_stdout",stderr:e+"_stderr",ppmDir:function(){var e=PPx.Extract("%'temp'%\\ppm");return PPx.Execute("*makedir "+e),e}}},r=PPx.CreateObject("Scripting.FileSystemObject"),isEmptyStr=function(e){return""===e},isEmptyObj=function(e){if(e===undefined)return!1;if(null===e)return!0;for(var t in e)return!1;return!0},n={TypeToCode:{crlf:"\r\n",cr:"\r",lf:"\n"},CodeToType:{"\r\n":"crlf","\r":"cr","\n":"lf"},Ppx:{lf:"%%bl",cr:"%%br",crlf:"%%bn",unix:"%%bl",mac:"%%br",dos:"%%bn","\n":"%%bl","\r":"%%br","\r\n":"%%bn"},Ascii:{lf:"10",cr:"13",crlf:"-1",unix:"10",mac:"13",dos:"-1","\n":"10","\r":"13","\r\n":"-1"}},i=["sjis","euc","utf8","utf8bom","unicode","utf16","unicodeb","utf16be","unicodebom","unicodebbom","ibm","us","ansi","latin1","system"],isCV8=function(){return"ClearScriptV8"===PPx.ScriptEngineName},_exec=function(e,t){try{var r;return[!1,null!=(r=t())?r:""]}catch(n){return[!0,""]}finally{e.Close()}},writeLines=function(e){var i=e.path,o=e.data,a=e.enc,u=void 0===a?"utf8":a,l=e.append,c=void 0!==l&&l,f=e.overwrite,p=void 0!==f&&f,s=e.linefeed,d=void 0===s?t.nlcode:s;if(!p&&!c&&r.FileExists(i))return[!0,i+" already exists"];var x,m=r.GetParentFolderName(i);if(r.FolderExists(m)||PPx.Execute("*makedir "+m),"utf8"===u){if(isCV8()){var v=o.join(d),P=c?"AppendAllText":"WriteAllText";return[!1,NETAPI.System.IO.File[P](i,v)]}var b=p||c?2:1,y=PPx.CreateObject("ADODB.Stream");x=_exec(y,(function(){y.Open(),y.Charset="UTF-8",y.LineSeparator=Number(n.Ascii[d]),c?(y.LoadFromFile(i),y.Position=y.Size,y.SetEOS):y.Position=0,y.WriteText(o.join(d),1),y.SaveToFile(i,b)}))[0]}else{var h=c?8:p?2:1;r.FileExists(i)||PPx.Execute("%Osq *makefile "+i);var E="utf16le"===u?-1:0,g=r.GetFile(i).OpenAsTextStream(h,E);x=_exec(g,(function(){g.Write(o.join(d)+d)}))[0]}return x?[!0,"Could not write to "+i]:[!1,""]},pathSelf=function(){var e,t,r=PPx.ScriptName;return~r.indexOf("\\")?(e=extractFileName(r),t=PPx.Extract("%*name(DKN,"+r+")")):(e=r,t=PPx.Extract("%FDN")),{scriptName:e,parentDir:t.replace(/\\$/,"")}},extractFileName=function(e,t){return void 0===t&&(t="\\"),"\\"!==t&&"/"!==t&&(t="\\"),e.slice(e.lastIndexOf(t)+1)};String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/,"")}),Array.prototype.removeEmpty||(Array.prototype.removeEmpty=function(){for(var e=[],t=0,r=this.length;t<r;t++){var n=this[t];null==n||""===n||n instanceof Array&&0===n.length||n instanceof Object&&isEmptyObj(n)||e.push(n)}return e}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var r;if(null==this)throw new Error('Array.indexOf: "this" is null or not defined');var n=Object(this),i=n.length>>>0;if(0===i)return-1;var o=null!=t?t:0;if(Math.abs(o)===Infinity&&(o=0),o>=i)return-1;for(r=Math.max(o>=0?o:i-Math.abs(o),0);r<i;){if(r in n&&n[r]===e)return r;r++}return-1}),e=PPx.Extract("%*getcust(S_ppm#global:git)"),isEmptyStr(e);var o=["query","save","silent","clear","modify","write","readonly"],_getEditmode=function(e,t,r,n){void 0===e&&(e=""),void 0===t&&(t=""),void 0===r&&(r=""),void 0===n&&(n=""),t=-1!==o.indexOf(t)?"-modify:"+t:"",isEmptyStr(r)||(r=_getEncode(r)),isEmptyStr(n)||(n=-1!==["crlf","cr","lf"].indexOf(n)?"-"+n:"-crlf");var i=[e,r,n,t].removeEmpty();return i.length>0?"*editmode "+i.join(" "):""},_getEncode=function(e){return~e.indexOf("codepage:")||(e=-1!==i.indexOf(e)?e:"utf8bom"),"-"+e},runPPe=function(e){var t=e.wait,r=void 0!==t&&t,n=e.path,i=void 0===n?"":n,o=e.encode,a=void 0===o?"utf8bom":o,u=e.linefeed,l=void 0===u?"crlf":u,c=e.title,f=e.tab,p=void 0===f?8:f,s=e.history,d=e.modify,x=e.saveenc,m=e.savelf,v=e.k,P=void 0===v?"":v,b=r?"*edit":"*ppe",y=i?"-new":"",h=_getEncode(a),E=-1!==["crlf","cr","lf"].indexOf(l)?"-"+l:"-crlf",g="-tab:"+p,O=[c=c?"*setcaption "+c:"",_getEditmode(s,d,x,m),P].removeEmpty();O.length>0&&(P="-k %("+O.join("%:")+"%)");var F=[b,y,h,E,g,i,P].removeEmpty().join(" ");PPx.Execute(F)},a="ppm-misc variables",u='%sgu"ppmcache"\\complist\\dispvar.txt',main=function(){var e=validArgs(),t=e.length;if(0===t||Number(e[0])>2){var r=pathSelf(),n=r.scriptName,i=r.parentDir;PPx.Execute('*script "%sgu\'ppmlib\'\\errors.js",arg,"'+i+"\\"+n+'"'),PPx.Quit(-1)}if(1===t){var o="'title': '"+a+"','mode':'g','list':'on','module':'off','detail':'user1 hist','leavecancel':false,'file':'"+u+"'",c=PPx.Extract('%*script("%sgu\'ppmlib\'\\input.js","{'+o+'}")');("[error]"===c||/^\s*;/.test(c))&&PPx.Quit(-1),e.push.apply(e,c.split(","))}for(var f=e.shift(),p=[];e.length>0;){var s,d=e.shift();if(0===(null==(s=d)?void 0:s.indexOf("$"))){var x=d.slice(1);d="PPx."+x+":\t"+_getValue(x)}else d=d+":\t"+PPx.Extract(d);p.push(d)}l[f](p)},l={0:function(e){var t=tmp().file;return writeLines({path:t,data:e,overwrite:!0}),runPPe({title:a,tab:25,path:t,modify:"silent"})},1:function(e){return PPx.Execute('%"'+a+'"%I"%('+e.join(t.nlcode)+'%)"')},2:function(e){return PPx.report(e.join(t.nlcode))}},c=/^([^(]+)\(([^)]+)\)$/,_getValue=function(e){return~e.indexOf("(")?e.replace(c,(function(e,t,r){return PPx[t](r)})):PPx[e]};main();
