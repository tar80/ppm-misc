var e,validArgs=function(){for(var e=[],t=PPx.Arguments;!t.atEnd();t.moveNext())e.push(t.value);return e},t={ppmName:"ppx-plugin-manager",ppmVersion:.95,language:"ja",encode:"utf16le",nlcode:"\r\n",nltype:"crlf",ppmID:"P",ppmSubID:"Q"},tmp=function(){var e=PPx.Extract('%*extract(C,"%%*temp()")');return{dir:e,file:e+"_ppmtemp",lf:e+"_temp.xlf",stdout:e+"_stdout",stderr:e+"_stderr",ppmDir:function(){var e=PPx.Extract("%'temp'%\\ppm");return PPx.Execute("*makedir "+e),e}}},r=PPx.CreateObject("Scripting.FileSystemObject"),isCV8=function(){return"ClearScriptV8"===PPx.ScriptEngineName},isEmptyStr=function(e){return""===e},isEmptyObj=function(e){if(e===undefined)return!1;if(null===e)return!0;for(var t in e)return!1;return!0},i={TypeToCode:{crlf:"\r\n",cr:"\r",lf:"\n"},CodeToType:{"\r\n":"crlf","\r":"cr","\n":"lf"},Ppx:{lf:"%%bl",cr:"%%br",crlf:"%%bn",unix:"%%bl",mac:"%%br",dos:"%%bn","\n":"%%bl","\r":"%%br","\r\n":"%%bn"},Ascii:{lf:"10",cr:"13",crlf:"-1",unix:"10",mac:"13",dos:"-1","\n":"10","\r":"13","\r\n":"-1"}},n=["sjis","euc","utf8","utf8bom","unicode","utf16","unicodeb","utf16be","unicodebom","unicodebbom","ibm","us","ansi","latin1","system"],exec=function(e,t){try{var r;return[!1,null!=(r=t())?r:""]}catch(i){return[!0,""]}finally{e.Close()}},writeLines=function(e){var n=e.path,o=e.data,a=e.enc,l=void 0===a?"utf8":a,u=e.append,c=void 0!==u&&u,f=e.overwrite,p=void 0!==f&&f,s=e.linefeed,d=void 0===s?t.nlcode:s;if(!p&&!c&&r.FileExists(n))return[!0,n+" already exists"];var m,x=r.GetParentFolderName(n);if(r.FolderExists(x)||PPx.Execute("*makedir "+x),"utf8"===l){if(isCV8()){var v=o.join(d),P=c?"AppendAllText":"WriteAllText";return[!1,NETAPI.System.IO.File[P](n,v)]}var b=p||c?2:1,y=PPx.CreateObject("ADODB.Stream");m=exec(y,(function(){y.Open(),y.Charset="UTF-8",y.LineSeparator=Number(i.Ascii[d]),c?(y.LoadFromFile(n),y.Position=y.Size,y.SetEOS):y.Position=0,y.WriteText(o.join(d),1),y.SaveToFile(n,b)}))[0]}else{var h=c?8:p?2:1;r.FileExists(n)||PPx.Execute("%Osq *makefile "+n);var E="utf16le"===l?-1:0,g=r.GetFile(n).OpenAsTextStream(h,E);m=exec(g,(function(){g.Write(o.join(d)+d)}))[0]}return m?[!0,"Could not write to "+n]:[!1,""]},pathSelf=function(){var e,t,r=PPx.ScriptName;return~r.indexOf("\\")?(e=r.replace(/^.*\\/,""),t=PPx.Extract("%*name(DKN,"+r+")")):(e=r,t=PPx.Extract("%FDN")),{scriptName:e,parentDir:t.replace(/\\$/,"")}};Array.prototype.removeEmpty||(Array.prototype.removeEmpty=function(){for(var e=[],t=0,r=this.length;t<r;t++){var i=this[t];null!=i&&""!==i&&(i instanceof Array&&0===i.length||i instanceof Object&&isEmptyObj(i)||e.push(i))}return e}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var r;if(null==this)throw new TypeError('Array.indexOf: "this" is null or not defined');var i=Object(this),n=i.length>>>0;if(0===n)return-1;var o=null!=t?t:0;if(Math.abs(o)===Infinity&&(o=0),o>=n)return-1;for(r=Math.max(o>=0?o:n-Math.abs(o),0);r<n;){if(r in i&&i[r]===e)return r;r++}return-1}),e=PPx.Extract("%*getcust(S_ppm#global:git)"),isEmptyStr(e);var o=["query","save","silent","clear","modify","write","readonly"],_getEditmode=function(e,t,r,i){void 0===e&&(e=""),void 0===t&&(t=""),void 0===r&&(r=""),void 0===i&&(i=""),t=-1!==o.indexOf(t)?"-modify:"+t:"",isEmptyStr(r)||(r=_getEncode(r)),isEmptyStr(i)||(i=-1!==["crlf","cr","lf"].indexOf(i)?"-"+i:"-crlf");var n=[e,r,i,t].removeEmpty();return n.length>0?"*editmode "+n.join(" "):""},_getEncode=function(e){return~e.indexOf("codepage:")||(e=-1!==n.indexOf(e)?e:"utf8bom"),"-"+e},runPPe=function(e){var t=e.wait,r=void 0!==t&&t,i=e.path,n=void 0===i?"":i,o=e.encode,a=void 0===o?"utf8bom":o,l=e.linefeed,u=void 0===l?"crlf":l,c=e.title,f=e.tab,p=void 0===f?8:f,s=e.history,d=e.modify,m=e.saveenc,x=e.savelf,v=e.k,P=void 0===v?"":v,b=r?"*edit":"*ppe",y=n?"-new":"",h=_getEncode(a),E=-1!==["crlf","cr","lf"].indexOf(u)?"-"+u:"-crlf",g="-tab:"+p,O=[c=c?"*setcaption "+c:"",_getEditmode(s,d,m,x),P].removeEmpty();O.length>0&&(P="-k %("+O.join("%:")+"%)");var j=[b,y,h,E,g,n,P].removeEmpty().join(" ");PPx.Execute(j)},a="ppm-misc variables",l="dispvar.txt",main=function(){var e=validArgs(),t=e.length;if(0===t||Number(e[0])>2){var r=pathSelf(),i=r.scriptName,n=r.parentDir;PPx.Execute('*script "%sgu\'ppmlib\'\\errors.js",arg,"'+n+"\\"+i+'"'),PPx.Quit(-1)}if(1===t){var o="'title': '"+a+"','mode':'e','leavecancel':true,'list':'on','module':'off','detail':'user1','file':'%sgu\"ppmcache\"\\list\\"+l+"'",c=PPx.Extract('%*script("%sgu\'ppmlib\'\\input.js","{'+o+'}")');("[error]"===c||/^\s*;/.test(c))&&PPx.Quit(-1),e.push.apply(e,c.split(","))}for(var f=e.shift(),p=[];e.length>0;){var s,d=e.shift();if(0===(null==(s=d)?void 0:s.indexOf("$"))){var m=d.slice(1);d="PPx."+m+":\t"+PPx[m]}else d=d+":\t"+PPx.Extract(d);p.push(d)}u[f](p)},u={0:function(e){var t=tmp().file;return writeLines({path:t,data:e,overwrite:!0}),runPPe({title:a,tab:25,path:t,modify:"silent"})},1:function(e){return PPx.Execute('%"'+a+'"%I"%('+e.join(t.nlcode)+'%)"')},2:function(e){return PPx.report(e.join(t.nlcode))}};main();
