var validArgs=function(){for(var e=[],t=PPx.Arguments;!t.atEnd();t.moveNext())e.push(t.value);return e},safeArgs=function(){for(var e=[],t=validArgs(),r=0,n=arguments.length;r<n;r++)e.push(_valueConverter(r<0||arguments.length<=r?undefined:arguments[r],t[r]));return e},_valueConverter=function(e,t){if(null==t||""===t)return null!=e?e:undefined;switch(typeof e){case"number":var r=Number(t);return isNaN(r)?e:r;case"boolean":return null!=t&&"false"!==t&&"0"!==t;default:return t}},e={ppmName:"ppx-plugin-manager",ppmVersion:.95,language:"ja",encode:"utf16le",nlcode:"\r\n",nltype:"crlf",ppmID:"P",ppmSubID:"Q"},useLanguage=function(){var t=PPx.Extract("%*getcust(S_ppm#global:lang)");return"en"===t||"ja"===t?t:e.language},tmp=function(){var e=PPx.Extract('%*extract(C,"%%*temp()")');return{dir:e,file:e+"_ppmtemp",lf:e+"_temp.xlf",stdout:e+"_stdout",stderr:e+"_stderr",ppmDir:function(){var e=PPx.Extract("%'temp'%\\ppm");return PPx.Execute("*makedir "+e),e}}},t=PPx.CreateObject("Scripting.FileSystemObject"),isEmptyStr=function(e){return""===e},r={TypeToCode:{crlf:"\r\n",cr:"\r",lf:"\n"},CodeToType:{"\r\n":"crlf","\r":"cr","\n":"lf"},Ppx:{lf:"%%bl",cr:"%%br",crlf:"%%bn",unix:"%%bl",mac:"%%br",dos:"%%bn","\n":"%%bl","\r":"%%br","\r\n":"%%bn"},Ascii:{lf:"10",cr:"13",crlf:"-1",unix:"10",mac:"13",dos:"-1","\n":"10","\r":"13","\r\n":"-1"}},expandNlCode=function(e){var t="\n",r=e.indexOf("\r");return~r&&(t="\r\n"===e.substring(r,r+2)?"\r\n":"\r"),t},isCV8=function(){return"ClearScriptV8"===PPx.ScriptEngineName},_exec=function(e,t){try{var r;return[!1,null!=(r=t())?r:""]}catch(n){return[!0,""]}finally{e.Close()}},read=function(e){var r=e.path,n=e.enc,a=void 0===n?"utf8":n;if(!t.FileExists(r))return[!0,r+" not found"];var i=t.GetFile(r);if(0===i.Size)return[!0,r+" has no data"];var l=!1,u="";if("utf8"===a){var o=PPx.CreateObject("ADODB.Stream"),p=_exec(o,(function(){return o.Open(),o.Charset="UTF-8",o.LoadFromFile(r),o.ReadText(-1)}));l=p[0],u=p[1]}else{var c="utf16le"===a?-1:0,s=i.OpenAsTextStream(1,c),f=_exec(s,(function(){return s.ReadAll()}));l=f[0],u=f[1]}return l?[!0,"Unable to read "+r]:[!1,u]},readLines=function(e){var t,r=e.path,n=e.enc,a=void 0===n?"utf8":n,i=e.linefeed,l=read({path:r,enc:a}),u=l[0],o=l[1];if(u)return[!0,o];i=null!=(t=i)?t:expandNlCode(o.slice(0,1e3));var p=o.split(i);return isEmptyStr(p[p.length-1])&&p.pop(),[!1,{lines:p,nl:i}]},writeLines=function(n){var a=n.path,i=n.data,l=n.enc,u=void 0===l?"utf8":l,o=n.append,p=void 0!==o&&o,c=n.overwrite,s=void 0!==c&&c,f=n.linefeed,x=void 0===f?e.nlcode:f;if(!s&&!p&&t.FileExists(a))return[!0,a+" already exists"];var m,d=t.GetParentFolderName(a);if(t.FolderExists(d)||PPx.Execute("*makedir "+d),"utf8"===u){if(isCV8()){var P=i.join(x),h=p?"AppendAllText":"WriteAllText";return[!1,NETAPI.System.IO.File[h](a,P)]}var v=s||p?2:1,g=PPx.CreateObject("ADODB.Stream");m=_exec(g,(function(){g.Open(),g.Charset="UTF-8",g.LineSeparator=Number(r.Ascii[x]),p?(g.LoadFromFile(a),g.Position=g.Size,g.SetEOS):g.Position=0,g.WriteText(i.join(x),1),g.SaveToFile(a,v)}))[0]}else{var E=p?8:s?2:1;t.FileExists(a)||PPx.Execute("%Osq *makefile "+a);var b="utf16le"===u?-1:0,S=t.GetFile(a).OpenAsTextStream(E,b);m=_exec(S,(function(){S.Write(i.join(x)+x)}))[0]}return m?[!0,"Could not write to "+a]:[!1,""]},n={en:{failedGetPath:"Failed to get path",noSearchWord:"Please specify search word",getHtml:"Getting",upperLimit:"Upper limit",noMatche:"No match"},ja:{failedGetPath:"パスの取得に失敗しました",noSearchWord:"検索単語を指定してください",getHtml:"取得中",upperLimit:"検索上限",noMatche:"一致なし"}},a="M_ppmHelp",i="http://toro.d.dooo.jp",l="utf8",u="\n",o={words:"ppxwords.html",index:"ppxindex.html",help:"ppxhelp.html",frame:"ppxframe.html"},p=PPx.Extract("%*getcust(S_ppm#user:misc_ppxhp)")||i,c='%*extract("%*getcust(S_ppm#user:misc_browser)") %*getcust(S_ppm#user:misc_helpopt)',s=n[useLanguage()],cache={words:[],isDebug:!1},main=function(){var e=safeArgs("","","0"),r=e[0],n=e[1],a=e[2];cache.isDebug="DEBUG"===a,!isEmptyStr(r)&&t.FolderExists(r)||(PPx.Echo(s.failedGetPath),PPx.Quit(-1));var i=prepareHelpFiles(r,o),u=i[0],p=i[1];if(u&&(PPx.Echo(p),PPx.Quit(-1)),isEmptyStr(n))return PPx.Execute('%K"@ESC"'),void PPx.Execute("*launch "+c+" "+r+"\\"+o.frame);var f=r+"\\"+o.words,x=readLines({path:f,enc:l}),m=x[0],d=x[1];m&&(PPx.Execute('%K"@ESC"'),PPx.Echo(d),PPx.Quit(-1)),PPx.StayMode=2,cache.words=d.lines,ppx_resume(r,n)},f=/^<a href="ppxhelp\.html#(.*)"\starget="main">(.+)<\/a><br>$/,x=/%|<\/?i>|&(quot|amp|lt|gt);/g,m={"%":"%%","<i>":"","</i>":"","&quot;":"","&amp;":"","&lt;":"<","&gt;":">"},ppx_finally=function(e){e&&PPx.Echo("[INFO] ppx_finally searchHelp.stay.js")},ppx_resume=function(t,r){if(!isEmptyStr(r)){var n=[a+"\t={"],i="file:///"+t.replace(/\\/g,"/")+"/"+o.help,l=9,u=0;do{var p=cache.words[l];if(p.toLowerCase().lastIndexOf(r)>40&&(p.replace(f,(function(e,t,r){r=r.replace(x,(function(e){return m[e]}));var a=String.fromCharCode(u+65);return n.push("&"+a+": "+r+"\t= *launch "+c+" "+i+"#"+t),""})),++u>25)){PPx.linemessage(s.upperLimit);break}l++}while(cache.words[l]);if(0!==u){n.push("}");var d=tmp().file,P=writeLines({path:d,data:n,enc:e.encode,linefeed:e.nlcode,overwrite:!0}),h=P[0],v=P[1];h&&(PPx.Echo(v),PPx.Quit(-1)),PPx.Execute("*setcust @"+d),PPx.Execute("%"+a+",A"),PPx.Execute('*deletecust "M_ppmHelp"'),PPx.Execute("*cursor -5")}else PPx.Execute("*linemessage "+s.noMatche+'%:%K"@^A"')}},_getHtml=function(e,r){var n=e+"\\"+r;t.FileExists(n)||(PPx.Execute("*linemessage *"+s.getHtml+"* "+r),PPx.Execute('*httpget "'+p+"/"+r+'","'+n+'"'),PPx.Execute("*linemessage"))},prepareHelpFiles=function(e,r){var n=e+"\\"+r.frame;if(!t.FileExists(n)){var a=writeLines({path:n,data:['<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Frameset//EN" "http://www.w3.org/TR/html4/frameset.dtd"><html lang="ja"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>PPx help</title></head>','<frameset cols="20%,*"><frame src="ppxwords.html" name="index"><frame src="ppxhelp.html" name="main"><noframes><body><a href="ppxhelp.html"></a></body></noframes></frameset></html>'],enc:l,linefeed:u,overwrite:!0}),i=a[0],o=a[1];if(i)return[!0,o]}return _getHtml(e,r.words),_getHtml(e,r.index),_getHtml(e,r.help),[!1,""]};main();
