var e=PPx.CreateObject("Scripting.FileSystemObject"),validArgs=function(){for(var e=[],t=PPx.Arguments;!t.atEnd();t.moveNext())e.push(t.value);return e},safeArgs=function(){for(var e=[],t=validArgs(),r=0,n=arguments.length;r<n;r++)e.push(_valueConverter(r<0||arguments.length<=r?undefined:arguments[r],t[r]));return e},_valueConverter=function(e,t){if(null==t||""===t)return null!=e?e:undefined;switch(typeof e){case"number":var r=Number(t);return Number.isNaN(r)?e:r;case"boolean":return null!=t&&"false"!==t&&"0"!==t;default:return t}},t={ppmName:"ppx-plugin-manager",ppmVersion:.95,language:"ja",encode:"utf16le",nlcode:"\r\n",nltype:"crlf",ppmID:"P",ppmSubID:"Q"},useLanguage=function(){var e=PPx.Extract("%*getcust(S_ppm#global:lang)");return"en"===e||"ja"===e?e:t.language},tmp=function(){var e=PPx.Extract('%*extract(C,"%%*temp()")');return{dir:e,file:e+"_ppmtemp",lf:e+"_temp.xlf",stdout:e+"_stdout",stderr:e+"_stderr",ppmDir:function(){var e=PPx.Extract("%'temp'%\\ppm");return PPx.Execute("*makedir "+e),e}}},isEmptyStr=function(e){return""===e},r={TypeToCode:{crlf:"\r\n",cr:"\r",lf:"\n"},CodeToType:{"\r\n":"crlf","\r":"cr","\n":"lf"},Ppx:{lf:"%%bl",cr:"%%br",crlf:"%%bn",unix:"%%bl",mac:"%%br",dos:"%%bn","\n":"%%bl","\r":"%%br","\r\n":"%%bn"},Ascii:{lf:"10",cr:"13",crlf:"-1",unix:"10",mac:"13",dos:"-1","\n":"10","\r":"13","\r\n":"-1"}},expandNlCode=function(e){var t="\n",r=e.indexOf("\r");return~r&&(t="\r\n"===e.substring(r,r+2)?"\r\n":"\r"),t},isCV8=function(){return"ClearScriptV8"===PPx.ScriptEngineName},_exec=function(e,t){try{var r;return[!1,null!=(r=t())?r:""]}catch(n){return[!0,""]}finally{e.Close()}},read=function(t){var r=t.path,n=t.enc,a=void 0===n?"utf8":n;if(!e.FileExists(r))return[!0,r+" not found"];var i=e.GetFile(r);if(0===i.Size)return[!0,r+" has no data"];var l=!1,u="";if("utf8"===a){var o=PPx.CreateObject("ADODB.Stream"),c=_exec(o,(function(){return o.Open(),o.Charset="UTF-8",o.LoadFromFile(r),o.ReadText(-1)}));l=c[0],u=c[1]}else{var p="utf16le"===a?-1:0,s=i.OpenAsTextStream(1,p),f=_exec(s,(function(){return s.ReadAll()}));l=f[0],u=f[1]}return l?[!0,"Unable to read "+r]:[!1,u]},readLines=function(e){var t,r=e.path,n=e.enc,a=void 0===n?"utf8":n,i=e.linefeed,l=read({path:r,enc:a}),u=l[0],o=l[1];if(u)return[!0,o];i=null!=(t=i)?t:expandNlCode(o.slice(0,1e3));var c=o.split(i);return isEmptyStr(c[c.length-1])&&c.pop(),[!1,{lines:c,nl:i}]},writeLines=function(n){var a=n.path,i=n.data,l=n.enc,u=void 0===l?"utf8":l,o=n.append,c=void 0!==o&&o,p=n.overwrite,s=void 0!==p&&p,f=n.linefeed,x=void 0===f?t.nlcode:f;if(!s&&!c&&e.FileExists(a))return[!0,a+" already exists"];var d,P=e.GetParentFolderName(a);if(e.FolderExists(P)||PPx.Execute("*makedir "+P),"utf8"===u){if(isCV8()){var m=i.join(x),h=c?"AppendAllText":"WriteAllText";return[!1,NETAPI.System.IO.File[h](a,m)]}var v=s||c?2:1,E=PPx.CreateObject("ADODB.Stream");d=_exec(E,(function(){E.Open(),E.Charset="UTF-8",E.LineSeparator=Number(r.Ascii[x]),c?(E.LoadFromFile(a),E.Position=E.Size,E.SetEOS):E.Position=0,E.WriteText(i.join(x),1),E.SaveToFile(a,v)}))[0]}else{var g=c?8:s?2:1;e.FileExists(a)||PPx.Execute("%Osq *makefile "+a);var b="utf16le"===u?-1:0,y=e.GetFile(a).OpenAsTextStream(g,b);d=_exec(y,(function(){y.Write(i.join(x)+x)}))[0]}return d?[!0,"Could not write to "+a]:[!1,""]},n={en:{failedGetPath:"Failed to get path",noSearchWord:"Please specify search word",getHtml:"Getting",upperLimit:"Upper limit",noMatche:"No match"},ja:{failedGetPath:"パスの取得に失敗しました",noSearchWord:"検索単語を指定してください",getHtml:"取得中",upperLimit:"検索上限",noMatche:"一致なし"}};Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var r;if(null==this)throw new Error('Array.indexOf: "this" is null or not defined');var n=Object(this),a=n.length>>>0;if(0===a)return-1;var i=null!=t?t:0;if(Math.abs(i)===Infinity&&(i=0),i>=a)return-1;for(r=Math.max(i>=0?i:a-Math.abs(i),0);r<a;){if(r in n&&n[r]===e)return r;r++}return-1});var a=["KC_main","KV_main","KV_img","KV_crt","KV_page","KB_edit","K_ppe","K_edit"],_validTable=function(e){return~a.indexOf(e)?e:"KC_main"},_discard=function(e){return function(t){var r=t.table,n=t.label,a=t.mapkey,i=t.cond,l=void 0===i?"instantly":i,u=t.debug,o=void 0===u?"0":u,c=PPx.StayMode,p=PPx.Extract("%n"),s=PPx.Extract("%FDV"),f="*linecust "+n+p+","+_validTable(r)+":"+e+",",x={instantly:"",once:'*if("'+p+'"=="%n")%:',hold:'*if("'+p+'"=="%n")&&("'+s+'"!="%FDV")%:'}[l],d=[f];a&&(PPx.Execute("*mapkey use,"+a),d.push("*mapkey delete,"+a)),d.push('*js ":'+c+',ppx_Discard",'+o+","+n),PPx.Execute(f+"%(*if %*stayinfo("+c+")%:"+x+d.join("%:")+"%)"),PPx.Execute('*run -nostartmsg %0pptrayw.exe -c %%K"@LOADCUST"')}},ppx_Discard=function(e,t){var r;PPx.StayMode=0,t=null!=(r=t)?r:"","DEBUG"===e&&PPx.linemessage("[DEBUG] discard "+t)},i={hold:function(e,t){void 0===t&&(t="0");var r=PPx.StayMode;l("KC_main","ACTIVEEVENT",e+"_%N",'*script ":'+r+',ppx_Discard",'+t+","+e,"instantly")},discard:_discard("ACTIVEEVENT")},l=(_discard("LOADEVENT"),function(e,t,r,n,a){var i="*linecust "+r+","+_validTable(e),l=i+":"+t+",",u={instantly:"",once:'*if("%n"=="%%n")',hold:'*if("%n"=="%%n")&&("%FDV"=="%%FDV")'}[a];PPx.Execute(i+":"+t+","+u+"%%:"+l+"%%:"+n),PPx.Execute('%K"@LOADCUST"')}),u="M_ppmHelp",o="http://toro.d.dooo.jp",c="utf8",p="\n",s={words:"ppxwords.html",index:"ppxindex.html",help:"ppxhelp.html",frame:"ppxframe.html"},f=PPx.Extract("%*getcust(S_ppm#user:misc_ppxhp)")||o,x='%*extract("%*getcust(S_ppm#user:misc_browser)") %*getcust(S_ppm#user:misc_helpopt)',d=n[useLanguage()],P=[],main=function(){var t=safeArgs("","","0"),r=t[0],n=t[1],a=t[2];!isEmptyStr(r)&&e.FolderExists(r)||(PPx.Echo(d.failedGetPath),PPx.Quit(-1));var l=prepareHelpFiles(r,s),u=l[0],o=l[1];if(u&&(PPx.Echo(o),PPx.Quit(-1)),isEmptyStr(n))return PPx.Execute('%K"@ESC"'),void PPx.Execute("*launch "+x+" "+r+"\\"+s.frame);var p=r+"\\"+s.words,f=readLines({path:p,enc:c}),m=f[0],h=f[1];m&&(PPx.Execute('%K"@ESC"'),PPx.Echo(h),PPx.Quit(-1)),PPx.StayMode=2,P=h.lines,i.hold("misc_help",a),ppx_resume(r,n)},_getHtml=function(t,r){var n=t+"\\"+r;e.FileExists(n)||(PPx.Execute("*linemessage *"+d.getHtml+"* "+r),PPx.Execute('*httpget "'+f+"/"+r+'","'+n+'"'),PPx.Execute("*linemessage"))},prepareHelpFiles=function(t,r){var n=t+"\\"+r.frame;if(!e.FileExists(n)){var a=writeLines({path:n,data:['<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Frameset//EN" "http://www.w3.org/TR/html4/frameset.dtd"><html lang="ja"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>PPx help</title></head>','<frameset cols="20%,*"><frame src="ppxwords.html" name="index"><frame src="ppxhelp.html" name="main"><noframes><body><a href="ppxhelp.html"></a></body></noframes></frameset></html>'],enc:c,linefeed:p,overwrite:!0}),i=a[0],l=a[1];if(i)return[!0,l]}return _getHtml(t,r.words),_getHtml(t,r.index),_getHtml(t,r.help),[!1,""]},m=/^<a href="ppxhelp\.html#(.*)"\starget="main">(.+)<\/a><br>$/,h=/%|<\/?i>|&(quot|amp|lt|gt);/g,v={"%":"%%","<i>":"","</i>":"","&quot;":"","&amp;":"","&lt;":"<","&gt;":">"},ppx_finally=function(){return PPx.Echo("[WARN] instance remain searchHelp.stay.js")},ppx_resume=function(e,r){if(!isEmptyStr(r)){var n=[u+"\t={"],a="file:///"+e.replace(/\\/g,"/")+"/"+s.help,i=9,l=0;do{var o=P[i];if(o.toLowerCase().lastIndexOf(r)>40&&(o.replace(m,(function(e,t,r){r=r.replace(h,(function(e){return v[e]}));var i=String.fromCharCode(l+65);return n.push("&"+i+": "+r+"\t= *launch "+x+" "+a+"#"+t),""})),++l>25)){PPx.linemessage(d.upperLimit);break}i++}while(P[i]);if(0!==l){n.push("}");var c=tmp().file,p=writeLines({path:c,data:n,enc:t.encode,linefeed:t.nlcode,overwrite:!0}),f=p[0],E=p[1];f&&(PPx.Echo(E),PPx.Quit(-1)),PPx.Execute("*setcust @"+c),PPx.Execute("%"+u+",A"),PPx.Execute('*deletecust "M_ppmHelp"'),PPx.Execute("*cursor -5")}else PPx.Execute("*linemessage "+d.noMatche+'%:%K"@^A"')}};main();
